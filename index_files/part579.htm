<!DOCTYPE  html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>SSL Handshake Protocol</title><link href="navigation.css" rel="stylesheet" type="text/css"/><link href="document.css" rel="stylesheet" type="text/css"/></head><body><p class="top_nav"><a href="part578.htm">&lt; Назад</a><span> | </span><a href="../index.html">Содержимое</a><span> | </span><a href="part580.htm">Далее &gt;</a></p><p style="padding-top: 6pt;padding-left: 5pt;text-indent: 0pt;text-align: justify;"><a href="#bookmark577" name="bookmark2501">SSL Handshake Protocol</a><a name="bookmark2633">&zwnj;</a><a name="bookmark2634">&zwnj;</a></p><p class="s46" style="padding-top: 5pt;padding-left: 6pt;text-indent: 0pt;text-align: justify;"><a href="part578.htm#bookmark2632" class="s23">It is a series of messages that a client and server exchange to establish a connection (and security capabilities associated with it) between them. Recall that an SSL connection between two parties is necessary before they can begin to exchange application layer data securely. </a><a href="part578.htm#bookmark2632" class="s3">Figure </a>15.25<span class="s10"> </span><span class="p">shows the format of these messages. The Handshake Protocol messages can be partitioned into</span></p><p class="s46" style="padding-top: 3pt;padding-left: 6pt;text-indent: 0pt;text-align: left;"><a href="part579.htm#bookmark2635" class="s23">the following four phases (see </a>Figure 15.26<span class="p">):</span></p><p style="padding-top: 9pt;padding-left: 23pt;text-indent: 0pt;text-align: left;">1. Establish security capabilities</p><p style="padding-top: 4pt;padding-left: 23pt;text-indent: 0pt;text-align: left;">2. Server authentication and key exchange</p><p style="padding-top: 4pt;padding-left: 23pt;text-indent: 0pt;text-align: left;">3. Client authentication and key exchange</p><p style="padding-top: 4pt;padding-left: 23pt;text-indent: 0pt;text-align: left;">4. Finish</p><p style="padding-left: 87pt;text-indent: 0pt;text-align: left;"><span><img width="408" height="750" alt="image" src="Image_835.jpg"/></span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s20" style="padding-top: 4pt;padding-left: 8pt;text-indent: 0pt;text-align: center;"><a name="bookmark2635">Figure 15.26. </a><span class="s21">Handshake Protocol messages partitioned into four phases.</span></p><p style="padding-top: 9pt;padding-left: 5pt;text-indent: 0pt;text-align: left;"><a name="bookmark2636">The four phases are described here.</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><h4 style="padding-left: 5pt;text-indent: 0pt;text-align: left;">Phase 1: Establish Security Capabilities</h4><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: justify;">A client initiates this phase for establishing a SSL connection with a server. The client and server exchange messages in this phase to establish the security capabilities associated with the connection. The client sends a <i>client_hello </i><a href="part579.htm#bookmark2637" class="s23">message with the parameters in </a><a href="part579.htm#bookmark2637" class="s3">Figure </a><span class="s46">15.27</span>, and waits for server&#39;s response. In response, the server sends a <i>server_hello </i><a href="part579.htm#bookmark2638" class="s23">message with the parameters in </a><a href="part579.htm#bookmark2638" class="s3">Figure </a><span class="s46">15.28</span>.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 60pt;text-indent: 0pt;text-align: left;"><span><img width="480" height="241" alt="image" src="Image_836.jpg"/></span></p><p class="s20" style="padding-top: 8pt;padding-left: 8pt;text-indent: 0pt;text-align: center;"><a name="bookmark2637">Figure 15.27. </a><span class="s21">Parameters of client_hello message of Handshake Protocol.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 60pt;text-indent: 0pt;text-align: left;"><span><img width="480" height="146" alt="image" src="Image_837.jpg"/></span></p><p class="s20" style="padding-top: 8pt;padding-left: 8pt;text-indent: 0pt;text-align: center;"><a name="bookmark2638">Figure 15.28. </a><span class="s21">Parameters of server_hello message of Handshake Protocol.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><h4 style="padding-top: 7pt;padding-left: 5pt;text-indent: 0pt;text-align: justify;">Phase 2: Server Authentication and Key Exchange</h4><p style="padding-top: 4pt;padding-left: 5pt;text-indent: 0pt;text-align: justify;">This phase starts with the server sending a <i>certificate </i>message containing one or a chain of</p><p style="padding-left: 5pt;text-indent: 0pt;text-align: justify;">X.509 certificates. This message is optional. It is required for any agreed-on key exchange method except Anonymous Diffie-Hellman.</p><p style="padding-top: 4pt;padding-left: 5pt;text-indent: 0pt;text-align: justify;"><a name="bookmark2639">The server then sends a </a><i>server-key-exchange </i>message. This message is optional. It is not needed either if the server has sent a certificate with Fixed Diffie-Hellman parameters, or if the protocol uses RSA key exchange. The message is needed in case of Anonymous Diffie-Hellman, Ephemeral Diffie-Hellman, Fortezza, or when the server uses RSA key exchange but has a signature-only RSA key.</p><p style="padding-top: 4pt;padding-left: 5pt;text-indent: 0pt;text-align: justify;">The server next sends a <i>certificate_request </i>message. This message is optional. It is required when a nonanonymous server (server not using Anonymous Diffie-Hellman) wants a certificate from the client. The message has the following two parameters:</p><p style="padding-top: 9pt;padding-left: 23pt;text-indent: 0pt;text-align: left;">1. <b>Certificate-type. </b>It contains the public-key algorithm and its use such as RSA for</p><p style="padding-top: 3pt;padding-left: 39pt;text-indent: 0pt;text-align: justify;">signature only, DSS for signature only, RSA for Fixed Diffie-Hellman, DSS for Fixed Diffie-Hellman, RSA for Ephemeral Diffie-Hellman, DSS for Ephemeral Diffie-Hellman, or Fortezza.</p><p style="padding-top: 4pt;padding-left: 39pt;text-indent: -15pt;text-align: justify;">2. <b>Certificate-authorities. </b>It contains a list of distinguished names of acceptable certificate authorities.</p><p style="padding-top: 9pt;padding-left: 5pt;text-indent: 0pt;text-align: justify;">The server then sends a <i>server_done </i>message, which is the last message of this phase. This message is mandatory and has no parameters. It indicates the end of <i>server_hello </i>and associated messages. The server waits for a client response after this.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><h4 style="padding-left: 5pt;text-indent: 0pt;text-align: left;">Phase 3: Client Authentication and Key Exchange</h4><p style="padding-top: 5pt;padding-left: 5pt;text-indent: 0pt;text-align: justify;">In this phase, the client verifies if the server provided a valid certificate (if the server sent certificates in the previous phase), and checks if the parameters received with <i>server_hello </i>message are acceptable.</p><p style="padding-top: 4pt;padding-left: 5pt;text-indent: 0pt;text-align: justify;">The client first sends a <i>certificate </i>message. This message is optional and is sent only if the server requested a certificate. If no suitable certificate is available, the client sends a <i>no_certificate </i>alert instead.</p><p style="padding-top: 4pt;padding-left: 5pt;text-indent: 0pt;text-align: justify;">The client then sends a <i>client_key_exchange </i>message, which is mandatory. The message contains appropriate parameters for the type of key exchange (RSA, Ephemeral Diffie-Hellman, Anonymous Diffie-Hellman, Fixed Diffie-Hellman, or Fortezza).</p><p style="padding-top: 4pt;padding-left: 5pt;text-indent: 0pt;text-align: justify;">The client finally sends a <i>certificate_verify </i>message in this phase. This message is optional and is only sent following any client certificate that has signing capability. This message provides explicit verification of a client certificate by signing a hash code based on the preceding message. The purpose is to verify the client&#39;s ownership of the private key for the client certificate. Even if an intruder misuses the client&#39;s certificate, he/she would be unable to send this message.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><h4 style="padding-left: 5pt;text-indent: 0pt;text-align: left;">Phase 4: Finish</h4><p style="padding-top: 5pt;padding-left: 6pt;text-indent: 0pt;text-align: justify;">This phase begins with the client sending a <i>change_cipher_spec </i>message. This message causes copying of pending state (CipherSpec) into current state (CipherSpec), which updates the cipher suite that the client and server use on this connection. Actually, this message is sent using the SSL Change Cipher Spec Protocol, and is not part of the SSL Handshake Protocol.</p><p style="padding-top: 4pt;padding-left: 6pt;text-indent: 0pt;text-align: justify;">The client then sends a <i>finished </i>message using the new algorithms, keys, and secrets. It verifies that the key exchange and authentication processes were successful.</p><p style="padding-top: 4pt;padding-left: 6pt;text-indent: 0pt;text-align: justify;">This phase ends with the server sending a <i>change_cipher_spec </i>message and a <i>finished </i>message in response to the client&#39;s messages. The former message causes copying of pending state (CipherSpec) into current state (CipherSpec), and the latter message verifies that the key exchange and authentication processes were successful.</p><p style="padding-top: 4pt;padding-left: 6pt;text-indent: 0pt;text-align: justify;">With this, the four phases of the SSL Handshake Protocol complete. The client and server are now ready to exchange application layer data securely.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="nav">&nbsp;&nbsp;</p><p class="nav">&nbsp;</p><p class="nav"><a href="part578.htm">&lt; Назад</a><span> | </span><a href="../index.html">Содержимое</a><span> | </span><a href="part580.htm">Далее &gt;</a></p><p class="nav">&nbsp;&nbsp;</p></body></html>
